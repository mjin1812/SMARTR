<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function also stores the mouse attribute names (not experiment attributes) as columns that will be used as categorical variables to make analysis subgroups.
The values of these attributes (group, drug, age) will automatically be converted to a string values for consistency."><title>Combine cell counts across all mice in an experiment into a single dataframe. — combine_cell_counts • SMARTR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Combine cell counts across all mice in an experiment into a single dataframe. — combine_cell_counts"><meta property="og:description" content="This function also stores the mouse attribute names (not experiment attributes) as columns that will be used as categorical variables to make analysis subgroups.
The values of these attributes (group, drug, age) will automatically be converted to a string values for consistency."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SMARTR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/SMARTR.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/1.Segmentation.html">1. Imaging, segmentation, and preprocessing</a>
    <a class="dropdown-item" href="../articles/2.Tutorial.html">2. Mapping Tutorial</a>
    <a class="dropdown-item" href="../articles/3.Scripting.html">3. Scripting &amp; notebooks</a>
    <a class="dropdown-item" href="../articles/4.Example%20Analysis%20Notebook.html">4. Example analysis notebook</a>
    <a class="dropdown-item" href="../articles/5.FAQ.html">5. FAQ</a>
    <a class="dropdown-item" href="../articles/6.Development.html">6. Development environment</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Combine cell counts across all mice in an experiment into a single dataframe.</h1>
      
      <div class="d-none name"><code>combine_cell_counts.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function also stores the mouse attribute names (not experiment attributes) as columns that will be used as categorical variables to make analysis subgroups.
The values of these attributes (<code>group</code>, <code>drug</code>, <code>age</code>) will automatically be converted to a string values for consistency.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">combine_cell_counts</span><span class="op">(</span><span class="va">e</span>, <span class="va">by</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>e</dt>
<dd><p>experiment object</p></dd>


<dt>by</dt>
<dd><p>(str) names of the experiment attributes (categorical variables) that will be used to create analysis subgroups.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    


    </div>
    <div class="section level2">
    <h2 id="channels">Channels<a class="anchor" aria-label="anchor" href="#channels"></a></h2>
    <p>channels &lt;- names(m$cell_table)</p>
    </div>
    <div class="section level2">
    <h2 id="loop-through-all-rois-and-get-all-subregions">Loop through all rois and get all subregions<a class="anchor" aria-label="anchor" href="#loop-through-all-rois-and-get-all-subregions"></a></h2>
    <p>regions &lt;- c(rois)
for (roi in rois) 
regions &lt;- c(regions, SMARTR::get.sub.structure(roi))</p><div class="section">
<h3 id="isolating-counts-from-the-hippocampus-amp-sorting-them-by-coordinate">Isolating counts from the hippocampus &amp; sorting them by coordinate<a class="anchor" aria-label="anchor" href="#isolating-counts-from-the-hippocampus-amp-sorting-them-by-coordinate"></a></h3>


<p>dHipp_cell_table &lt;- vector(mode = "list", length = length(channels))
vHipp_cell_table &lt;- vector(mode = "list", length = length(channels))
names(dHipp_cell_table) &lt;- channels
names(vHipp_cell_table) &lt;- channels</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="process-each-channel-separately">process each channel separately<a class="anchor" aria-label="anchor" href="#process-each-channel-separately"></a></h2>
    <p>hipp_AP_coordinates &lt;- c()
for (channel in channels)</p><div class="sourceCode"><pre><code># Get cell table of just the hippocampus
hipp_df &lt;- m$cell_table[[channel]] %&gt;% dplyr::filter(acronym %in% regions)# Store dorsal counts if there are any, else erase
if (sum(hipp_df$AP &gt; AP_coord) &gt; 0){
  dHipp_cell_table[[channel]] &lt;- hipp_df[hipp_df$AP &gt; AP_coord, ]
} else {
  dHipp_cell_table[[channel]] &lt;- NULL
}# Store ventral counts if there are any, else erase
if (sum(hipp_df$AP &lt;= AP_coord) &gt; 0){
  vHipp_cell_table[[channel]] &lt;- hipp_df[hipp_df$AP &lt;= AP_coord, ]
} else {
  vHipp_cell_table[[channel]] &lt;- NULL
}# Keep track of the unique AP coordinate (slice identifier)
hipp_AP_coordinates &lt;- c(hipp_AP_coordinates, hipp_df$AP) %&gt;% unique()# Remove existing hippocampus data from the normalized cell counts table if it exists
if (!is.null(m$normalized_counts) &amp; merge){
  hipp_delete &lt;- which(m$normalized_counts[[channel]]$acronym %in% regions)
  m$normalized_counts[[channel]] &lt;- m$normalized_counts[[channel]][-hipp_delete,]  message(paste0("Removed existing hippocampus data for ", channel,
                 " channel from the normalized counts dataframe"))
}
</code></pre></div>
    </div>
    <div class="section level2">
    <h2 id="get-hippocampal-areas">Get hippocampal areas<a class="anchor" aria-label="anchor" href="#get-hippocampal-areas"></a></h2>
    <p>DV_volumes &lt;- get_hipp_DV_volumes(m, AP_coord = AP_coord, rois = rois, hipp_AP_coordinates)</p>
    </div>
    <div class="section level2">
    <h2 id="create-combine-cell-table-and-initialize-list-for-normalized-hippocampus-cell-counts">Create combine cell_table and initialize list for normalized hippocampus cell counts<a class="anchor" aria-label="anchor" href="#create-combine-cell-table-and-initialize-list-for-normalized-hippocampus-cell-counts"></a></h2>
    <p>hipp_cell_tables &lt;- list(dHipp_cell_table,vHipp_cell_table)
hipp_norm_counts &lt;- vector(mode = "list", length = 2)
names(hipp_cell_tables) &lt;- c("dorsal", "ventral")
names(hipp_norm_counts) &lt;- c("dorsal", "ventral")</p>
    </div>
    <div class="section level2">
    <h2 id="get-normalized-cell-counts">Get normalized cell counts<a class="anchor" aria-label="anchor" href="#get-normalized-cell-counts"></a></h2>
    


    </div>
    <div class="section level2">
    <h2 id="whether-to-merge-the-information-in-each-channel-to-the-large-normalized-counts-dataframe">Whether to merge the information in each channel to the large normalized counts dataframe<a class="anchor" aria-label="anchor" href="#whether-to-merge-the-information-in-each-channel-to-the-large-normalized-counts-dataframe"></a></h2>
    <p>if (merge)
# merged right.hemisphere check
if (is.null(m$normalized_counts[1]$right.hemisphere) &amp;&amp; is.null(hipp_norm_counts[1][1]$right.hemisphere) ||
!is.null(m$normalized_counts[1]$right.hemisphere) &amp;&amp; !is.null(hipp_norm_counts[1][1]$right.hemisphere))</p><div class="sourceCode"><pre><code>  ## continue with merge
  for (dv in names(hipp_norm_counts)){
    for (channel in channels){
      m$normalized_counts[[channel]] &lt;- rbind(m$normalized_counts[[channel]], hipp_norm_counts[[dv]][[channel]]) %&gt;% arrange(acronym)
    }
  }
  message("Merged into main normalized counts dataframe.")} else {
  stop(paste0("If you want to merge the dorsal ventral split dataset into the main normalized counts dataframe, the \n",
              "combine_hemispheres parameter needs to be identical when you run normalize_cell_counts() and split_hipp_DV()."))
}
</code></pre></div> else 
m$hipp_DV_normalized_counts &lt;- hipp_norm_counts
message("Data is now stored in hipp_DV_normalized_counts dataframe. Future analysis of the hippocampus will be stored separately."))
return(m)
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">combine_cell_counts</span><span class="op">(</span><span class="va">e</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'groups'</span>, <span class="st">'sex'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in combine_cell_counts(e, by = c("groups", "sex")):</span> object 'e' not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michelle Jin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

