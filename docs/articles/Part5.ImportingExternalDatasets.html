<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SMARTTR">
<title>5. Importing External Datasets • SMARTTR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. Importing External Datasets">
<meta property="og:description" content="SMARTTR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SMARTTR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/SMARTTR.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Part1.Segmentation.html">1. Imaging, segmentation, and preprocessing</a>
    <a class="dropdown-item" href="../articles/Part2.Tutorial.html">2. Mapping Tutorial</a>
    <a class="dropdown-item" href="../articles/Part3.Scripting.html">3. Scripting &amp; notebooks</a>
    <a class="dropdown-item" href="../articles/Part4.Example_Analysis_Notebook.html">4. Example analysis notebook</a>
    <a class="dropdown-item" href="../articles/Part5.ImportingExternalDatasets.html">5. Importing External Datasets</a>
    <a class="dropdown-item" href="../articles/Part6.FAQ.html">6. FAQ</a>
    <a class="dropdown-item" href="../articles/Part7.Development.html">7. Development environment</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mjin1812/SMARTTR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>5. Importing External Datasets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mjin1812/SMARTTR/blob/HEAD/vignettes/Part5.ImportingExternalDatasets.Rmd" class="external-link"><code>vignettes/Part5.ImportingExternalDatasets.Rmd</code></a></small>
      <div class="d-none name"><code>Part5.ImportingExternalDatasets.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="formatting-and-downloading-an-example-dataset">Formatting and downloading an example dataset<a class="anchor" aria-label="anchor" href="#formatting-and-downloading-an-example-dataset"></a>
</h2>
<p>This vignette is guide for those interested in using SMARTTR’s
analysis and visualization functions for externally mapped brainwide
datasets (typically from light sheet fluorescent microscopy or serial
2-photon microscopy). SMARTTR’s hierarchical data storage makes it easy
to import external datasets. The figure below shows that inputs to
analysis and visualization functions are experiment objects.</p>
<figure><img src="../reference/figures/ImportingExternalDatasets_1.JPG" alt="Image" style="width: 700px;"><figcaption><em>Where imported data lies in the object hiearchy.</em>
</figcaption></figure><p>In this tutorial we will read a novel unpublished LSFM dataset of
c-Fos expression mapped to Yongsoo Kim lab’s <a href="https://kimlab.io/brain-map/atlas/" class="external-link">unified atlas</a>. You can
download the example scrambled dataset <a href="https://osf.io/45qbj/" class="external-link">here</a>!</p>
<blockquote>
<p>This dataset was provided as a courtesy from the Heshmati and Golden
Labs from the University of Washington. However, the data grouping have
been randomized for the <code>mouse_ID</code> and categorical variables
such as <code>group</code> and <code>sex</code> compared to the original
dataset.</p>
</blockquote>
<div class="section level3">
<h3 id="data-formatting">Data Formatting<a class="anchor" aria-label="anchor" href="#data-formatting"></a>
</h3>
<p>The downloaded .csv file also serves as an instruction template for
formatting external datasets for importation.</p>
<figure><img src="../reference/figures/StandardizedImportingFormat.JPG" alt="Image" style="width: 800px;"><figcaption><em>Standardized formatting for importing external data.</em>
</figcaption></figure><p>Below we detail more about the column entries:</p>
<ul>
<li>
<code>mouse_ID</code> - is a unique mouse id given. It can be a
combination of letters and numbers. We recommend each mouse have a
unique ID, without spaces.</li>
<li>
<code>group:sex</code> - a flexible number of columns to store
categorical variables of relevance to most systems neuroscience
experiments. Coding is case sensitive (e.g. “Female” vs “female”). The
<code>group</code> category is the most generic, if none of the other
categories fit.</li>
<li>
<code>acronym</code> - ontology-specific region acronyms. Case
sensitive.</li>
<li>
<code>name</code> - ontology-specific long-form region names Case
sensitive.</li>
<li>
<code>counts</code> - the absolute number of cells counted.</li>
<li>
<code>volume.mm3</code> - the volume of each region in
mm<sup>3</sup>
</li>
<li>
<code>normalized.counts.by.volume</code> - the <code>counts</code>
column divided by the <code>volume.mm3</code> column.</li>
</ul>
<p>In this tutorial, we use the <code>group</code> variable to subdivide
and analyze control mice, coded as <code>Control</code>, and inhaled
anesthesia-exposed mice, coded as <code>Isoflurane</code>.</p>
</div>
<div class="section level3">
<h3 id="ontology-support">Ontology support<a class="anchor" aria-label="anchor" href="#ontology-support"></a>
</h3>
<p>Of note, the example dataset given is fully expanded in its nested
ontology structure. This means there are subregions included, such as
sublayers of the cortex, that can be folded into parent structures.</p>
<p>Below we illustrate this nested structure for the Allen Mouse
ontology.</p>
<figure><img src="../reference/figures/coarsening_nodes_ontology.JPG" alt="Image" style="width: 500px;"><figcaption><em>Nested ontology.</em>
</figcaption></figure><p>However, as part of a pre-processing step, it is highly recommended
to fold smaller sub-regions into their larger parent region. While
detailed sub-regional mapping is nice, there is a point where inclusion
of each smaller sub-region begins to dilute out larger topological
patterns in networks if instead they were folded them into their parent
structure. SMARTTR includes folding options based on keyword matches to
reduce the ontological “resolution”. See the section “Clean redundant
parent region data” for more information.</p>
<p>Currently the supported ontologies for folding are:</p>
<ul>
<li>The <a href="https://doi.org/10.1016/j.cell.2020.04.007" class="external-link">Allen Mouse
CCF</a> from the Allen Institute</li>
<li>The <a href="https://www.nature.com/articles/s41467-019-13057-w" class="external-link">unified
atlas</a> from Yongsoo Kim’s lab.</li>
</ul>
<p>Please reach out and provide a full ontology tree if you would like
another ontology supported!</p>
</div>
</div>
<div class="section level2">
<h2 id="data-importation-and-pre-processing">Data importation and pre-processing<a class="anchor" aria-label="anchor" href="#data-importation-and-pre-processing"></a>
</h2>
<div class="section level3">
<h3 id="import-necessary-dependencies">Import necessary dependencies<a class="anchor" aria-label="anchor" href="#import-necessary-dependencies"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Packages to load</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjin1812.github.io/SMARTTR/">SMARTTR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-an-experiment-object">Create an experiment object<a class="anchor" aria-label="anchor" href="#create-an-experiment-object"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating an experiment object named "anesthesia" </span></span>
<span><span class="co"># Enter the channels parameter to distinguish which IEG(s) is/are stained.</span></span>
<span><span class="co"># Note, the other categorical variables will be auto-imported from the dataset</span></span>
<span></span>
<span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>experiment_name <span class="op">=</span> <span class="st">"anesthesia"</span>,</span>
<span>                         channels <span class="op">=</span> <span class="st">"cfos"</span>,       <span class="co"># If you have more than one channel to import, set this to a character vector, e.g. c("cfos", "eyfp")</span></span>
<span>                         output_path <span class="op">=</span> <span class="st">"P:\\DENNYLABV\\Michelle_Jin\\Wholebrain pipeline\\example_data\\example_experiment"</span><span class="op">)</span> <span class="co">#Set this to a path location where you want your figures/analysis output to save, e.g. "P:\\DENNYLABV\\Michelle_Jin\\experiment\\folder"</span></span>
<span>                         <span class="co"># output_path = tempdir()) #Set this to a path location where you want your figures/analysis output to save, e.g. "P:\\DENNYLABV\\Michelle_Jin\\experiment\\folder"</span></span>
<span></span>
<span></span>
<span><span class="co"># Print experiment object to make sure metadata is up to date</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">anesthesia</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $experiment_name</span></span>
<span><span class="co">## [1] "anesthesia"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $experimenters</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $channels</span></span>
<span><span class="co">## [1] "cfos"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $experiment_groups</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $drug_groups</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sex_groups</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cohorts</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $strains</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genotypes</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $reporters</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ages</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $output_path</span></span>
<span><span class="co">## [1] "P:\\DENNYLABV\\Michelle_Jin\\Wholebrain pipeline\\example_data\\example_experiment"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="import-and-preprocess-your-externally-mapped-dataset">Import and preprocess your externally mapped dataset<a class="anchor" aria-label="anchor" href="#import-and-preprocess-your-externally-mapped-dataset"></a>
</h3>
<p>The <code><a href="../reference/import_mapped_datasets.html">import_mapped_datasets()</a></code> is a helper function that
makes it easy to import the formatted csv file into the proper location
in the experiment object. It will also auto-detect the categorical
variables used in the dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_mapped_datasets.html">import_mapped_datasets</a></span><span class="op">(</span><span class="va">anesthesia</span>, </span>
<span>                                     normalized_count_paths <span class="op">=</span> <span class="st">"P:\\DENNYLABV\\Michelle_Jin\\Wholebrain pipeline\\example_data\\anesthesia\\unified_ontology_unchecked.csv"</span>,</span>
<span>                                     show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">anesthesia</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $experiment_name</span></span>
<span><span class="co">## [1] "anesthesia"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $experimenters</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $channels</span></span>
<span><span class="co">## [1] "cfos"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $experiment_groups</span></span>
<span><span class="co">## [1] "Control"    "Isoflurane"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $drug_groups</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sex_groups</span></span>
<span><span class="co">## [1] "Female" "Male"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cohorts</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $strains</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $genotypes</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $reporters</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ages</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $output_path</span></span>
<span><span class="co">## [1] "P:\\DENNYLABV\\Michelle_Jin\\Wholebrain pipeline\\example_data\\example_experiment"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If you have more than one channel data set to import, you would specify the normalized_count_paths </span></span>
<span><span class="co"># as a vector of named strings, with the names corresponding to the channel names.</span></span>
<span><span class="co"># Uncomment the lines below:</span></span>
<span></span>
<span><span class="co"># anesthesia &lt;- import_mapped_datasets(anesthesia,</span></span>
<span><span class="co">#                                      normalized_count_paths = c(cfos = "P:\\example\\path\\to\\first\\dataset.csv",</span></span>
<span><span class="co">#                                                                 eyfp = "P:\\example\\path\\to\\second\\dataset.csv"))</span></span></code></pre></div>
<div class="section level4">
<h4 id="quality-check-for-matching-ontology-naming">Quality check for matching ontology naming<a class="anchor" aria-label="anchor" href="#quality-check-for-matching-ontology-naming"></a>
</h4>
<p>This dataset uses the Kim Unified Ontology. The code below prints the
first few entries of the Kim Unified Ontology.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">SMARTTR</span><span class="fu">::</span><span class="va"><a href="../reference/ontology.unified.html">ontology.unified</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 x 6</span></span></span>
<span><span class="co">##      id acronym   name                     structure_order parent parent_acronym</span></span>
<span><span class="co">##   <span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>                              </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span>  </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>         </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span><span>   997 root      root                                   0    997 root          </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span><span>     8 grey      Basic cell groups and r~             100    997 root          </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span><span>   567 CH        Cerebrum                             200      8 grey          </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span><span>   688 CTX       Cerebral cortex                      300    567 CH            </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span><span>   695 CTXpl     Cortical plate                       400    688 CTX           </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span><span>   315 Isocortex Isocortex                            500    695 CTXpl</span></span></span></code></pre>
<p>SMARTTR requires that the ontology acronyms and full length region
names of your dataset are perfectly matched with those of the stored
ontology. Sometimes during the data exportation process, additional
characters suchas as commas, semicolons, and spaces are erroneously
introduced into acronyms or names.</p>
<p>Here, we use the <code>check_ontology_coding function()</code> to
correct any discrepencies and match to the internal ontologies stored in
SMARTTR. This step may take a minute if the dataset is quite large.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ontology</span> <span class="op">&lt;-</span> <span class="st">"unified"</span>   <span class="co"># Set to "allen" if you are using the allen ontology</span></span>
<span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_ontology_coding.html">check_ontology_coding</a></span><span class="op">(</span><span class="va">anesthesia</span>, ontology <span class="op">=</span> <span class="va">ontology</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cleaning-based-on-regions-to-include">Cleaning based on regions to include<a class="anchor" aria-label="anchor" href="#cleaning-based-on-regions-to-include"></a>
</h4>
<p>If there are a standardized set of regions you wish to analyze, to
the exclusion of others, you may use the function
<code><a href="../reference/filter_regions.html">filter_regions()</a></code> to specify the acronyms of the base parent
regions (which includes all subregions) you wish to analyze.</p>
<p>The example below shows the inclusion of the isocortex, olfactory
bulb, hippocampal formation, cortical subplate, cerebral nuclei,
thalamus, hypothalamus, midbrain, and hindbrain. Exclusion of the
acronym, <code>CBL</code> automatically removes the cerebellum from the
dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_regions.html">filter_regions</a></span><span class="op">(</span><span class="va">anesthesia</span>, </span>
<span>                            base_regions <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Isocortex"</span>, <span class="st">"OLF"</span>, <span class="st">"HPF"</span>, <span class="st">"CTXsp"</span>, <span class="st">"CNU"</span>,<span class="st">"TH"</span>, <span class="st">"HY"</span>, <span class="st">"MB"</span>, <span class="st">"HB"</span><span class="op">)</span>,</span>
<span>                            ontology <span class="op">=</span> <span class="va">ontology</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="clean-redundant-parent-region-data">Clean redundant parent region data<a class="anchor" aria-label="anchor" href="#clean-redundant-parent-region-data"></a>
</h4>
<p>Your dataset may contain redundant information because it includes
counts at different “ontological” resolutions. A region of cortex
(e.g. primary motor, M1) may be split into layer 1 (M1-1) , layer 2/3
(M1-2/3), etc. But total counts summed across all the layers (M1) may be
entered as an additional row. SMARTTR initially operates at the highest
“resolution” and later on, can fold sub-regions into parent regions
later. Therefore redundant counts from parent regions should be removed
with <code><a href="../reference/exclude_redundant_regions.html">exclude_redundant_regions()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exclude_redundant_regions.html">exclude_redundant_regions</a></span><span class="op">(</span><span class="va">anesthesia</span>, ontology <span class="op">=</span> <span class="va">ontology</span><span class="op">)</span></span></code></pre></div>
<p>Note: See also the function <code><a href="../reference/check_redundant_parents.html">check_redundant_parents()</a></code>,
which detects redundant parents. It returns a named list with two
elements <code>redundant_parents</code> (vector of acronyms) and
<code>unique_acronyms</code> (vector of acronyms of subregions to
retain)</p>
</div>
<div class="section level4">
<h4 id="simplify-regions">Simplify regions<a class="anchor" aria-label="anchor" href="#simplify-regions"></a>
</h4>
<p>To aid analysis interpretability, it is helpful to perform analysis
at a certain ontology resolution. This is done by folding small
sub-regions into their larger parent region based on exact keyword
matches in their long-form name. This accomplished with the
<code><a href="../reference/simplify_cell_count.html">simplify_cell_count()</a></code> function.</p>
<p>For example, inclusion of the keyword “layer” results in detection of
all regions containing this word, which are then subfolded into their
parent region. This is done recursively, until there are no regions
containing this keyword in the dataset. See the help page for
<code>simplify_cell_counts()</code> for the default recommended list of
regions for the Allen CCF ontology.</p>
<p>Below we create curated list of simplification keywords/phrases based
on the analysis needs of this dataset and inspection of full names of
the unified ontology (You can inspect the ontology <a href="https://osf.io/45qbj/" class="external-link">here.</a>). The ones you use may be
customized to suit your own needs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simplify_keywords</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"layer"</span>, <span class="st">"zone"</span>,  <span class="st">"area 1"</span>, <span class="st">"area 2"</span>, <span class="st">"area 3"</span>, </span>
<span>                      <span class="st">"subnucleus"</span>, <span class="st">"division"</span>, <span class="st">"Caudoputamen-"</span>, <span class="st">"Intergeniculate"</span>, <span class="st">"Pregeniculate"</span>, </span>
<span>                      <span class="st">"Subgeniculate"</span>, <span class="st">"Island"</span>, <span class="st">"fields of Forel"</span>, <span class="st">"Cajal"</span>, <span class="st">"Darkschewitsch"</span>, </span>
<span>                      <span class="st">"Precommissural"</span>, <span class="st">"cells"</span>, <span class="st">"stratum"</span>, <span class="st">"layer 1"</span>, <span class="st">"layer 2"</span>, </span>
<span>                      <span class="st">"layer 2/3"</span>, <span class="st">"layer 3"</span>, <span class="st">"layer 4"</span>, <span class="st">"layer 5"</span>, <span class="st">"layer 6"</span>, </span>
<span>                      <span class="st">"layer 6a"</span>, <span class="st">"layer 6b"</span>, <span class="st">"lucidum"</span>, <span class="st">"radiatum"</span>, <span class="st">"parvicellular"</span>, </span>
<span>                      <span class="st">"anterolateral"</span>, <span class="st">"region"</span>, <span class="st">"mediolateral"</span>, <span class="st">"mediomedial"</span>, <span class="st">"dorsal part"</span>, </span>
<span>                      <span class="st">"external part"</span>, <span class="st">"lateral part"</span>, <span class="st">"medial part"</span>, <span class="st">"ventral part"</span>, <span class="st">"posterior part"</span>, </span>
<span>                      <span class="st">"central part"</span>, <span class="st">"Dorsomedial"</span>, <span class="st">"Dorsal lateral"</span>, <span class="st">"Dorsolateral"</span>, <span class="st">"Dorsomedial"</span>, </span>
<span>                      <span class="st">"ventrolateral"</span>, <span class="st">"Lateral dorsal"</span>, <span class="st">"Laterodorsal"</span>, <span class="st">"Lateral posterior"</span>, <span class="st">"Medioventral"</span>, </span>
<span>                      <span class="st">"Posterodorsal"</span>, <span class="st">"Posterolateral"</span>, <span class="st">"Ventromedidal"</span>, <span class="st">"binocular"</span>, <span class="st">"monocular"</span>, </span>
<span>                      <span class="st">"tubercle"</span>, <span class="st">"intraamygdaloid"</span>, <span class="st">"Anteroventral"</span>, <span class="st">"core"</span>,  <span class="st">"shell"</span>,</span>
<span>                      <span class="st">"Ventral anterior"</span>, <span class="st">"Ventral intermediate"</span>, <span class="st">"dorsal area"</span>, <span class="st">"ventral area"</span>, <span class="st">"Anterodorsal"</span>, </span>
<span>                      <span class="st">"Dorsal intermediate"</span>, <span class="st">"medial nucleus"</span>, <span class="st">"principal nucleus"</span>, <span class="st">"Lateroventral"</span>, <span class="st">"Rostral ventral"</span>, </span>
<span>                      <span class="st">"dorsal cap"</span>, <span class="st">"fusiform"</span>, <span class="st">"Caudomedial"</span>, <span class="st">"medial nucleus"</span>, <span class="st">"Posteromedial"</span>, </span>
<span>                      <span class="st">"Lateral superior"</span>, <span class="st">"Medial superior"</span>, <span class="st">"band"</span>,  <span class="st">"dorsal part"</span>, <span class="st">"VTA"</span>,  </span>
<span>                      <span class="st">"anterior division"</span>, <span class="st">"oral part"</span>, <span class="st">"lateral area"</span>, <span class="st">"medial area"</span>, <span class="st">"area 29 and 30"</span>, </span>
<span>                      <span class="st">"Triangular nucleus"</span>, <span class="st">"Intermediate nucleus of the"</span>,   <span class="st">"Ventral nucleus of the"</span>, <span class="st">"Dorsal nucleus of the"</span>, <span class="st">"Recess of the"</span>, </span>
<span>                      <span class="st">"Commisural nucleus of the"</span>,     <span class="st">"External cortex of the"</span>, <span class="st">"Dorsal Cortex of the"</span>, <span class="st">"Central nucleus of the"</span>, <span class="st">", dorsal nucleus"</span>, </span>
<span>                      <span class="st">"cortex 1"</span>, <span class="st">"cortex 2"</span>, <span class="st">"cortex 3"</span>, <span class="st">"prosomere 1 p"</span>, <span class="st">"pleoglial"</span>, </span>
<span>                      <span class="st">"Lateral periaqueductal"</span>, <span class="st">"related"</span>, <span class="st">"prosomere 1"</span>, <span class="st">"Ventral cochlear"</span>, <span class="st">"Dorsal cochlear"</span>, </span>
<span>                      <span class="st">"Cell bridges of the"</span>, <span class="st">"Commissural nucleus of the"</span>,    <span class="st">"Nucleus of the brachium of the"</span>,</span>
<span>                      <span class="st">"intermediate part"</span>, <span class="st">"Zona limitans"</span>, <span class="st">"Posterodorsal"</span>, <span class="st">"interfascicular part"</span><span class="op">)</span></span></code></pre></div>
<p>Below we simplify the counts by keywords chosen and recalculate the
normalized counts</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simplify the acronyms by the keyworks and recalculate the normalized counts</span></span>
<span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simplify_cell_count.html">simplify_cell_count</a></span><span class="op">(</span><span class="va">anesthesia</span>, ontology <span class="op">=</span> <span class="va">ontology</span>, simplify_keywords <span class="op">=</span> <span class="va">simplify_keywords</span>, dont_fold <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cleaning-regions-to-exclude">Cleaning regions to exclude<a class="anchor" aria-label="anchor" href="#cleaning-regions-to-exclude"></a>
</h3>
<p>As another pre-processing step, you may want to exclude a custom list
of regions. This may be due to your analysis needs or physical tissue
preparation limitations. The function <code><a href="../reference/exclude_by_acronym.html">exclude_by_acronym()</a></code>
allows for this using a list of acronyms from supported ontologies
(allen or unified). The function <code>exclude_by_keywords()</code>
allows for this using a list of keywords included in the long-form name
of a region. Below illustrates both of these functions as further
cleaning steps.</p>
<p>Load and print list of chosen exclusion acronyms</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exclusion_acronyms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fiber_tracts"</span>, <span class="st">"cm"</span>, <span class="st">"2n"</span>, <span class="st">"s5"</span>, <span class="st">"8cn"</span>, <span class="st">"sst"</span>, <span class="st">"cbf"</span>, <span class="st">"cbp"</span>, <span class="st">"scp"</span>, <span class="st">"mcp"</span>, <span class="st">"lfbs"</span>, </span>
<span>                        <span class="st">"cc"</span>, <span class="st">"fmi"</span>, <span class="st">"cst"</span>, <span class="st">"lfbst"</span>, <span class="st">"eps"</span>, <span class="st">"epsc"</span>, <span class="st">"ts"</span>, <span class="st">"rs"</span>, <span class="st">"mfbs"</span>, <span class="st">"mfbc"</span>, <span class="st">"fxs"</span>, </span>
<span>                         <span class="st">"fxpo"</span>, <span class="st">"hc"</span>, <span class="st">"st"</span>, <span class="st">"mfbsma"</span>, <span class="st">"mfbse"</span>, <span class="st">"VS"</span>, <span class="st">"3V"</span>, <span class="st">"4V"</span>, <span class="st">"drt"</span><span class="op">)</span></span></code></pre></div>
<p>clean the dataset based on exclusion acronyms</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exclude_by_acronym.html">exclude_by_acronym</a></span><span class="op">(</span><span class="va">anesthesia</span>, acronyms <span class="op">=</span> <span class="va">exclusion_acronyms</span>, ontology <span class="op">=</span> <span class="va">ontology</span><span class="op">)</span></span></code></pre></div>
<p>Exclude based on keywords detected in the long-form name</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keywords_exclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nerve"</span>, <span class="st">"tract"</span>, <span class="st">"pineal gland"</span>, <span class="st">"   Area subpostrema"</span><span class="op">)</span></span>
<span><span class="va">anesthesia</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/exclude_by_keyword.html">exclude_by_keyword</a></span><span class="op">(</span><span class="va">anesthesia</span>, keywords <span class="op">=</span> <span class="va">keywords_exclude</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="optional-quality-checking">Optional quality checking<a class="anchor" aria-label="anchor" href="#optional-quality-checking"></a>
</h4>
<p>Add an additional threshold to remove all low activation region
(predominately hindbrain) This step primarily removes small-area regions
that are probably adding noise to the analysis. If a regions possesses 1
or less cfos counts, it is removed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thresh</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">anesthesia</span><span class="op">$</span><span class="va">combined_normalized_counts</span><span class="op">$</span><span class="va">cfos</span> <span class="op">&lt;-</span> <span class="va">anesthesia</span><span class="op">$</span><span class="va">combined_normalized_counts</span><span class="op">$</span><span class="va">cfos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">counts</span> <span class="op">&gt;=</span> <span class="va">thresh</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Please note that in this notebook, <code>%&gt;%</code> is a pipe
operator, and allows for stringing together multiple functions. This
means the output of one function automatically is fed as a parameter
into the next function.</p>
</blockquote>
<p>Remove outliers for each subgroup.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_outlier_counts.html">find_outlier_counts</a></span><span class="op">(</span><span class="va">anesthesia</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>, n_sd <span class="op">=</span> <span class="fl">2</span>, remove <span class="op">=</span> <span class="cn">TRUE</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 98 x 9</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   mouse_ID, group, sex, acronym [98]</span></span></span>
<span><span class="co">##    mouse_ID group   sex   acronym name  counts volume.mm3 normalized.count.by.~1</span></span>
<span><span class="co">##    <span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span>      </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span>                  </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span><span> 5        Control Fema~ 5Te     Moto~    152     0.104                   </span><span style="text-decoration: underline;">1</span><span>462.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span><span> 2        Control Fema~ A24 (C~ Cing~  </span><span style="text-decoration: underline;">20</span><span>920     3.69                    </span><span style="text-decoration: underline;">5</span><span>666.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span><span> 2        Control Fema~ ATg     Ante~     49     0.015</span><span style="text-decoration: underline;">7</span><span>                  </span><span style="text-decoration: underline;">3</span><span>125 </span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span><span> 2        Control Fema~ Acb     Accu~  </span><span style="text-decoration: underline;">14</span><span>833     4.80                    </span><span style="text-decoration: underline;">3</span><span>088.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span><span> 2        Control Fema~ BLA     Baso~   </span><span style="text-decoration: underline;">1</span><span>745     0.664                   </span><span style="text-decoration: underline;">2</span><span>628.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span><span> 2        Control Fema~ Ect     Ecto~  </span><span style="text-decoration: underline;">12</span><span>268     3.11                    </span><span style="text-decoration: underline;">3</span><span>945.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span><span> 2        Control Fema~ IG      Indu~    110     0.028</span><span style="text-decoration: underline;">2</span><span>                  </span><span style="text-decoration: underline;">3</span><span>901.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span><span> 5        Control Fema~ IMA     Intr~     89     0.039</span><span style="text-decoration: underline;">0</span><span>                  </span><span style="text-decoration: underline;">2</span><span>284.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span><span> 2        Control Fema~ LM      Late~    194     0.044</span><span style="text-decoration: underline;">9</span><span>                  </span><span style="text-decoration: underline;">4</span><span>323.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span><span> 2        Control Fema~ LPtA    Late~   </span><span style="text-decoration: underline;">1</span><span>534     0.619                   </span><span style="text-decoration: underline;">2</span><span>477.</span></span></span>
<span><span class="co">## <span style="color: #949494;"># i 88 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># i abbreviated name: 1: normalized.count.by.volume</span></span></span>
<span><span class="co">## <span style="color: #949494;"># i 1 more variable: outlier &lt;lgl&gt;</span></span></span></code></pre>
<p>Detect if each region is represented by a minimum number of mice
(<code>min_n</code>) per subgroup (Control or Isoflurane groups).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anesthesia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/enough_mice_per_group.html">enough_mice_per_group</a></span><span class="op">(</span><span class="va">anesthesia</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span>, min_n <span class="op">=</span> <span class="fl">4</span>, remove <span class="op">=</span> <span class="cn">TRUE</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="checkpoint-load-default-saved-experiment-object-here">Checkpoint load default saved experiment object here<a class="anchor" aria-label="anchor" href="#checkpoint-load-default-saved-experiment-object-here"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_experiment.html">save_experiment</a></span><span class="op">(</span><span class="va">anesthesia</span>, timestamp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michelle Jin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
